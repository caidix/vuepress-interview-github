(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{484:function(s,e,t){"use strict";t.r(e);var n=t(1),a=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("em",[s._v("tree shaking")]),s._v(" 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块系统中的"),e("a",{attrs:{href:"http://exploringjs.com/es6/ch_modules.html#static-module-structure",target:"_blank",rel:"noopener noreferrer"}},[s._v("静态结构特性"),e("OutboundLink")],1),s._v("，例如 "),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("import")]),e("OutboundLink")],1),s._v(" 和 "),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("export")]),e("OutboundLink")],1),s._v("。这个术语和概念实际上是兴起于 ES2015 模块打包工具 "),e("a",{attrs:{href:"https://github.com/rollup/rollup",target:"_blank",rel:"noopener noreferrer"}},[s._v("rollup"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("新的 webpack 4 正式版本，扩展了这个检测能力，通过 "),e("code",[s._v("package.json")]),s._v(" 的 "),e("code",[s._v('"sideEffects"')]),s._v(' 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 "pure(纯的 ES2015 模块)"，由此可以安全地删除文件中未使用的部分。')]),s._v(" "),e("blockquote",[e("p",[s._v("本指南的继承自"),e("a",{attrs:{href:"https://www.webpackjs.com/guides/getting-started",target:"_blank",rel:"noopener noreferrer"}},[s._v("起步指南"),e("OutboundLink")],1),s._v("。如果你尚未阅读该指南，请先行阅读。")])]),s._v(" "),e("h2",{attrs:{id:"添加一个通用模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加一个通用模块"}},[s._v("#")]),s._v(" 添加一个通用模块")]),s._v(" "),e("p",[s._v("在我们的项目中添加一个新的通用模块文件 "),e("code",[s._v("src/math.js")]),s._v("，此文件导出两个函数：")]),s._v(" "),e("p",[e("strong",[s._v("project")])]),s._v(" "),e("div",{staticClass:"language-diff line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[s._v("webpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- bundle.js\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.html\n")])]),s._v("|- /src\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- index.js\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" |- math.js\n")])]),s._v("|- /node_modules\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[e("strong",[s._v("src/math.js")])]),s._v(" "),e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("square")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cube")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("接着，更新入口脚本，使用其中一个新方法，并且为了简单，将 "),e("code",[s._v("lodash")]),s._v(" 删除：")]),s._v(" "),e("p",[e("strong",[s._v("src/index.js")])]),s._v(" "),e("div",{staticClass:"language-diff line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[e("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[e("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import _ from 'lodash';\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" import { cube } from './math.js';\n")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" function component() {\n")])]),e("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[e("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('div');\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   var element = document.createElement('pre');\n")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[e("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   // lodash 是由当前 script 脚本 import 导入进来的\n")]),e("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   element.innerHTML = [\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     'Hello webpack!',\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("     '5 cubed is equal to ' + cube(5)\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   ].join('\\n\\n');\n")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   return element;\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" document.body.appendChild(component());\n")])])])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("注意，我们"),e("strong",[s._v("并未从 "),e("code",[s._v("src/math.js")]),s._v(" 模块中 "),e("code",[s._v("import")]),s._v(" 导入 "),e("code",[s._v("square")]),s._v(" 方法")]),s._v("。这个功能是所谓的“未引用代码(dead code)”，也就是说，应该删除掉未被引用的 "),e("code",[s._v("export")]),s._v("。现在让我们运行我们的npm 脚本 "),e("code",[s._v("npm run build")]),s._v("，并检查输出的 bundle：")]),s._v(" "),e("p",[e("strong",[s._v("dist/bundle.js (around lines 90 - 100)")])]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 1 */")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/***/")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __webpack_exports__"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __webpack_require__")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* unused harmony export square */")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* harmony export (immutable) */")]),s._v(" __webpack_exports__"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cube"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("square")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cube")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("x")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("注意，上面的 "),e("code",[s._v("unused harmony export square")]),s._v(" 注释。如果你看下面的代码，你会注意到 "),e("code",[s._v("square")]),s._v(" 没有被导入，但是，它仍然被包含在 bundle 中。我们将在下一节中解决这个问题。")]),s._v(" "),e("h2",{attrs:{id:"将文件标记为无副作用-side-effect-free"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将文件标记为无副作用-side-effect-free"}},[s._v("#")]),s._v(" 将文件标记为无副作用(side-effect-free)")]),s._v(" "),e("p",[s._v("在一个纯粹的 ESM 模块世界中，识别出哪些文件有副作用很简单。然而，我们的项目无法达到这种纯度，所以，此时有必要向 webpack 的 compiler 提供提示哪些代码是“纯粹部分”。")]),s._v(" "),e("p",[s._v("这种方式是通过 package.json 的 "),e("code",[s._v('"sideEffects"')]),s._v(" 属性来实现的。")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("如同上面提到的，如果所有代码都不包含副作用，我们就可以简单地将该属性标记为 "),e("code",[s._v("false")]),s._v("，来告知 webpack，它可以安全地删除未用到的 export 导出。")]),s._v(" "),e("blockquote",[e("p",[s._v("「副作用」的定义是，在导入时会执行特殊行为的代码，而不是仅仅暴露一个 export 或多个 export。举例说明，例如 polyfill，它影响全局作用域，并且通常不提供 export。")])]),s._v(" "),e("p",[s._v("如果你的代码确实有一些副作用，那么可以改为提供一个数组：")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/some-side-effectful-file.js"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("数组方式支持相关文件的相对路径、绝对路径和 glob 模式。它在内部使用 "),e("a",{attrs:{href:"https://github.com/micromatch/micromatch#matching-features",target:"_blank",rel:"noopener noreferrer"}},[s._v("micromatch"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("blockquote",[e("p",[s._v("注意，任何导入的文件都会受到 tree shaking 的影响。这意味着，如果在项目中使用类似 "),e("code",[s._v("css-loader")]),s._v(" 并导入 CSS 文件，则需要将其添加到 side effect 列表中，以免在生产模式中无意中将它删除：")])]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your-project"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/some-side-effectful-file.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.css"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("最后，还可以在 "),e("a",{attrs:{href:"https://github.com/webpack/webpack/issues/6065#issuecomment-351060570",target:"_blank",rel:"noopener noreferrer"}},[e("code",[s._v("module.rules")]),s._v(" 配置选项"),e("OutboundLink")],1),s._v(" 中设置 "),e("code",[s._v('"sideEffects"')]),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"压缩输出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#压缩输出"}},[s._v("#")]),s._v(" 压缩输出")]),s._v(" "),e("p",[s._v("通过如上方式，我们已经可以通过 "),e("code",[s._v("import")]),s._v(" 和 "),e("code",[s._v("export")]),s._v(" 语法，找出那些需要删除的“未使用代码(dead code)”，然而，我们不只是要找出，还需要在 bundle 中删除它们。为此，我们将使用 "),e("code",[s._v("-p")]),s._v("(production) 这个 webpack 编译标记，来启用 uglifyjs 压缩插件。")]),s._v(" "),e("blockquote",[e("p",[s._v("注意，"),e("code",[s._v("--optimize-minimize")]),s._v(" 标记也会在 webpack 内部调用 "),e("code",[s._v("UglifyJsPlugin")]),s._v("。")])]),s._v(" "),e("p",[s._v("从 webpack 4 开始，也可以通过 "),e("code",[s._v('"mode"')]),s._v(" 配置选项轻松切换到压缩输出，只需设置为 "),e("code",[s._v('"production"')]),s._v("。")]),s._v(" "),e("p",[e("strong",[s._v("webpack.config.js")])]),s._v(" "),e("div",{staticClass:"language-diff line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-diff"}},[e("code",[s._v("const path = require('path');\n\nmodule.exports = {\n"),e("span",{pre:!0,attrs:{class:"token unchanged"}},[e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" entry: './src/index.js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" output: {\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   filename: 'bundle.js',\n")]),e("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v("   path: path.resolve(__dirname, 'dist')\n")])]),e("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[e("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" }\n")])]),e("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(" },\n")]),e("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token line"}},[s._v(' mode: "production"\n')])]),s._v("};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("blockquote",[e("p",[s._v("注意，也可以在命令行接口中使用 "),e("code",[s._v("--optimize-minimize")]),s._v(" 标记，来使用 "),e("code",[s._v("UglifyJSPlugin")]),s._v("。")])]),s._v(" "),e("p",[s._v("准备就绪后，然后运行另一个命令 "),e("code",[s._v("npm run build")]),s._v("，看看输出结果有没有发生改变。")]),s._v(" "),e("p",[s._v("你发现 "),e("code",[s._v("dist/bundle.js")]),s._v(" 中的差异了吗？显然，现在整个 bundle 都已经被精简过，但是如果仔细观察，则不会看到 "),e("code",[s._v("square")]),s._v(" 函数被引入，但会看到 "),e("code",[s._v("cube")]),s._v(" 函数的修改版本（"),e("code",[s._v("function r(e){return e*e*e}n.a=r")]),s._v("）。现在，随着 tree shaking 和代码压缩，我们的 bundle 减小几个字节！虽然，在这个特定示例中，可能看起来没有减少很多，但是，在具有复杂的依赖树的大型应用程序上运行时，tree shaking 或许会对 bundle 产生显著的体积优化。")]),s._v(" "),e("h2",{attrs:{id:"结论"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),e("p",[s._v("为了学会使用 "),e("em",[s._v("tree shaking")]),s._v("，你必须……")]),s._v(" "),e("ul",[e("li",[s._v("使用 ES2015 模块语法（即 "),e("code",[s._v("import")]),s._v(" 和 "),e("code",[s._v("export")]),s._v("）。")]),s._v(" "),e("li",[s._v("在项目 "),e("code",[s._v("package.json")]),s._v(' 文件中，添加一个 "sideEffects" 入口。')]),s._v(" "),e("li",[s._v("引入一个能够删除未引用代码(dead code)的压缩工具(minifier)（例如 "),e("code",[s._v("UglifyJSPlugin")]),s._v("）。")])]),s._v(" "),e("p",[s._v("你可以将应用程序想象成一棵树。绿色表示实际用到的源码和 library，是树上活的树叶。灰色表示无用的代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。")])])}),[],!1,null,null,null);e.default=a.exports}}]);